{% extends 'base.html' %}
{% load static %}

{% block title %}Analytics - Smart Task Manager{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
/* Analytics Page - Liquid Glass Design */
.analytics-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0;
    overflow: hidden;
}

.orb {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    animation: orbFloat 20s ease-in-out infinite;
}

.orb-1 {
    width: 600px;
    height: 600px;
    background: linear-gradient(135deg, #EC4899, #8B5CF6);
    top: -20%;
    left: -10%;
    opacity: 0.5;
}

.orb-2 {
    width: 500px;
    height: 500px;
    background: linear-gradient(135deg, #06B6D4, #10B981);
    bottom: -15%;
    right: -10%;
    opacity: 0.4;
    animation-delay: -7s;
}

.orb-3 {
    width: 350px;
    height: 350px;
    background: linear-gradient(135deg, #F59E0B, #EC4899);
    top: 40%;
    right: 20%;
    opacity: 0.3;
    animation-delay: -14s;
}

@keyframes orbFloat {
    0%, 100% { transform: translate(0, 0) scale(1); }
    25% { transform: translate(40px, -40px) scale(1.1); }
    50% { transform: translate(-20px, 20px) scale(0.95); }
    75% { transform: translate(20px, 40px) scale(1.05); }
}

/* Grid Pattern */
.grid-pattern {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
        linear-gradient(rgba(236, 72, 153, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(236, 72, 153, 0.03) 1px, transparent 1px);
    background-size: 60px 60px;
    z-index: 0;
    pointer-events: none;
}

/* Page Header */
.page-header {
    position: relative;
    z-index: 1;
    margin-bottom: 2rem;
}

.header-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 24px 32px;
    background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.02));
    backdrop-filter: blur(40px);
    -webkit-backdrop-filter: blur(40px);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 28px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.3);
}

.header-info h1 {
    font-size: 32px;
    font-weight: 800;
    background: linear-gradient(135deg, #fff 0%, #f9a8d4 50%, #EC4899 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin: 0 0 6px;
}

.header-info p {
    color: rgba(255,255,255,0.6);
    font-size: 14px;
    margin: 0;
}

.header-actions {
    display: flex;
    gap: 12px;
}

/* Buttons */
.btn {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 14px 24px;
    border-radius: 16px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: none;
    font-family: inherit;
}

.btn-primary {
    background: linear-gradient(135deg, #EC4899, #8B5CF6);
    color: #fff;
    box-shadow: 0 8px 25px rgba(236, 72, 153, 0.4);
}

.btn-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 35px rgba(236, 72, 153, 0.5);
}

.btn-secondary {
    background: rgba(255,255,255,0.06);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.1);
    color: #fff;
}

.btn-secondary:hover {
    background: rgba(255,255,255,0.12);
    border-color: rgba(236, 72, 153, 0.5);
}

.btn-small {
    padding: 10px 16px;
    font-size: 13px;
    border-radius: 12px;
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-bottom: 1.5rem;
    position: relative;
    z-index: 1;
}

.stats-grid-secondary {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-bottom: 2rem;
    position: relative;
    z-index: 1;
}

.stat-card {
    position: relative;
    padding: 28px;
    background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.02));
    backdrop-filter: blur(40px);
    -webkit-backdrop-filter: blur(40px);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 24px;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--stat-color), transparent);
    opacity: 0;
    transition: opacity 0.3s;
}

.stat-card:hover {
    transform: translateY(-8px);
    border-color: rgba(236, 72, 153, 0.4);
    box-shadow: 0 25px 50px rgba(0,0,0,0.4), 0 0 50px var(--stat-glow);
}

.stat-card:hover::before {
    opacity: 1;
}

.stat-card:nth-child(1) { --stat-color: #EC4899; --stat-glow: rgba(236, 72, 153, 0.2); }
.stat-card:nth-child(2) { --stat-color: #8B5CF6; --stat-glow: rgba(139, 92, 246, 0.2); }
.stat-card:nth-child(3) { --stat-color: #06B6D4; --stat-glow: rgba(6, 182, 212, 0.2); }
.stat-card:nth-child(4) { --stat-color: #10B981; --stat-glow: rgba(16, 185, 129, 0.2); }

.stat-card.productivity { --stat-color: #F59E0B; --stat-glow: rgba(245, 158, 11, 0.2); }
.stat-card.efficiency { --stat-color: #10B981; --stat-glow: rgba(16, 185, 129, 0.2); }
.stat-card.quality { --stat-color: #8B5CF6; --stat-glow: rgba(139, 92, 246, 0.2); }
.stat-card.velocity { --stat-color: #06B6D4; --stat-glow: rgba(6, 182, 212, 0.2); }

.stat-trend {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-top: 12px;
    font-size: 13px;
    color: rgba(255,255,255,0.5);
}

.stat-trend.up {
    color: #10B981;
}

.stat-trend.down {
    color: #EF4444;
}

.stat-trend i {
    font-size: 12px;
}

.progress-ring {
    position: relative;
    width: 56px;
    height: 56px;
}

.progress-ring svg {
    transform: rotate(-90deg);
}

.progress-ring-bg {
    fill: none;
    stroke: rgba(255,255,255,0.1);
    stroke-width: 6;
}

.progress-ring-fill {
    fill: none;
    stroke: var(--stat-color, #10B981);
    stroke-width: 6;
    stroke-linecap: round;
    transition: stroke-dashoffset 1s ease;
}

.stat-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.stat-label {
    font-size: 14px;
    color: rgba(255,255,255,0.6);
    font-weight: 500;
    margin-bottom: 10px;
}

.stat-value {
    font-size: 48px;
    font-weight: 800;
    color: #fff;
    line-height: 1;
    text-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

.stat-icon {
    width: 56px;
    height: 56px;
    border-radius: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--stat-color), rgba(255,255,255,0.1));
    color: #fff;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    font-size: 24px;
}

/* Glass Card */
.glass-card {
    position: relative;
    z-index: 1;
    background: linear-gradient(145deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
    backdrop-filter: blur(40px);
    -webkit-backdrop-filter: blur(40px);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 28px;
    padding: 32px;
    margin-bottom: 24px;
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    flex-wrap: wrap;
    gap: 16px;
}

.card-title {
    font-size: 22px;
    font-weight: 700;
    color: #fff;
    display: flex;
    align-items: center;
    gap: 12px;
}

.card-title i {
    color: #EC4899;
}

/* Charts Container */
.charts-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin-bottom: 24px;
}

.chart-card {
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 20px;
    padding: 24px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.chart-card:hover {
    background: rgba(255,255,255,0.08);
    border-color: rgba(236, 72, 153, 0.3);
    transform: translateY(-4px);
    box-shadow: 0 15px 40px rgba(0,0,0,0.2);
}

.chart-header {
    margin-bottom: 20px;
}

.chart-title {
    font-size: 16px;
    font-weight: 700;
    color: #fff;
    margin: 0 0 8px;
}

.chart-subtitle {
    font-size: 13px;
    color: rgba(255,255,255,0.5);
    margin: 0;
}

.chart-placeholder {
    width: 100%;
    height: 250px;
    background: rgba(255,255,255,0.02);
    border: 1px dashed rgba(255,255,255,0.1);
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(255,255,255,0.3);
    font-size: 14px;
}

/* Filter Tabs */
.filter-tabs {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 24px;
}

.filter-tab {
    padding: 10px 18px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    color: rgba(255,255,255,0.7);
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
}

.filter-tab:hover {
    background: rgba(255,255,255,0.1);
    border-color: rgba(236, 72, 153, 0.3);
}

.filter-tab.active {
    background: linear-gradient(135deg, rgba(236, 72, 153, 0.2), rgba(139, 92, 246, 0.2));
    border-color: rgba(236, 72, 153, 0.5);
    color: #fff;
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: rgba(255,255,255,0.5);
}

.empty-state i {
    font-size: 64px;
    margin-bottom: 20px;
    opacity: 0.3;
}

.empty-state h3 {
    font-size: 20px;
    color: rgba(255,255,255,0.7);
    margin-bottom: 10px;
}

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
}

.slide-up { animation: slideUp 0.6s ease forwards; }
.fade-in { animation: fadeIn 0.6s ease forwards; }

/* Responsive */
@media (max-width: 1200px) {
    .stats-grid, .stats-grid-secondary { grid-template-columns: repeat(2, 1fr); }
    .charts-grid { grid-template-columns: 1fr; }
}

@media (max-width: 768px) {
    .header-card {
        flex-direction: column;
        gap: 20px;
        padding: 20px;
        text-align: center;
    }
    .header-actions { width: 100%; justify-content: center; }
    .stats-grid, .stats-grid-secondary { grid-template-columns: 1fr 1fr; }
    .stat-value { font-size: 36px; }
}
</style>
{% endblock %}

{% block content %}
<!-- Animated Background -->
<div class="analytics-bg">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
</div>
<div class="grid-pattern"></div>

<!-- Page Header -->
<header class="page-header slide-up">
    <div class="header-card">
        <div class="header-info">
            <h1>Analytics</h1>
            <p>Track performance and insights</p>
        </div>
        <div class="header-actions">
            <button class="btn btn-secondary" id="refresh-btn">
                <i class="fas fa-sync-alt"></i>
                Refresh
            </button>
            <button class="btn btn-primary" id="export-btn">
                <i class="fas fa-download"></i>
                Export Report
            </button>
        </div>
    </div>
</header>

<!-- Stats Cards - Primary -->
<div class="stats-grid fade-in">
    <div class="stat-card">
        <div class="stat-header">
            <div>
                <div class="stat-label">Total Tasks</div>
                <div class="stat-value" id="total-tasks">0</div>
            </div>
            <div class="stat-icon">
                <i class="fas fa-tasks"></i>
            </div>
        </div>
        <div class="stat-trend up" id="tasks-trend">
            <i class="fas fa-arrow-up"></i>
            <span>+12% this month</span>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-header">
            <div>
                <div class="stat-label">Completed</div>
                <div class="stat-value" id="completed-tasks">0</div>
            </div>
            <div class="stat-icon">
                <i class="fas fa-check-circle"></i>
            </div>
        </div>
        <div class="stat-trend up" id="completed-trend">
            <i class="fas fa-trophy"></i>
            <span>Great progress!</span>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-header">
            <div>
                <div class="stat-label">In Progress</div>
                <div class="stat-value" id="progress-tasks">0</div>
            </div>
            <div class="stat-icon">
                <i class="fas fa-spinner"></i>
            </div>
        </div>
        <div class="stat-trend" id="progress-trend">
            <i class="fas fa-bolt"></i>
            <span>Active work</span>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-header">
            <div>
                <div class="stat-label">Projects</div>
                <div class="stat-value" id="total-projects">0</div>
            </div>
            <div class="stat-icon">
                <i class="fas fa-folder"></i>
            </div>
        </div>
        <div class="stat-trend" id="projects-trend">
            <i class="fas fa-briefcase"></i>
            <span>Active projects</span>
        </div>
    </div>
</div>

<!-- Stats Cards - Secondary -->
<div class="stats-grid-secondary fade-in" style="animation-delay: 0.2s;">
    <div class="stat-card productivity">
        <div class="stat-header">
            <div>
                <div class="stat-label">Productivity</div>
                <div class="stat-value" id="productivity-score">0%</div>
            </div>
            <div class="stat-icon" style="background: linear-gradient(135deg, #F59E0B, rgba(255,255,255,0.1));">
                <i class="fas fa-chart-line"></i>
            </div>
        </div>
        <div class="stat-trend up" id="productivity-trend">
            <i class="fas fa-fire"></i>
            <span>Keep it up!</span>
        </div>
    </div>
    
    <div class="stat-card efficiency">
        <div class="stat-header">
            <div>
                <div class="stat-label">Efficiency</div>
                <div class="stat-value" id="efficiency-score">0%</div>
            </div>
            <div class="stat-icon" style="background: linear-gradient(135deg, #10B981, rgba(255,255,255,0.1));">
                <i class="fas fa-gauge-high"></i>
            </div>
        </div>
        <div class="stat-trend up" id="efficiency-trend">
            <i class="fas fa-rocket"></i>
            <span>Excellent!</span>
        </div>
    </div>
    
    <div class="stat-card quality">
        <div class="stat-header">
            <div>
                <div class="stat-label">Quality Score</div>
                <div class="stat-value" id="quality-score">0%</div>
            </div>
            <div class="stat-icon" style="background: linear-gradient(135deg, #8B5CF6, rgba(255,255,255,0.1));">
                <i class="fas fa-star"></i>
            </div>
        </div>
        <div class="stat-trend up" id="quality-trend">
            <i class="fas fa-certificate"></i>
            <span>High quality</span>
        </div>
    </div>
    
    <div class="stat-card velocity">
        <div class="stat-header">
            <div>
                <div class="stat-label">Team Velocity</div>
                <div class="stat-value" id="velocity-score">0</div>
            </div>
            <div class="progress-ring">
                <svg width="56" height="56">
                    <circle class="progress-ring-bg" cx="28" cy="28" r="22"></circle>
                    <circle class="progress-ring-fill" id="velocity-circle" cx="28" cy="28" r="22" 
                            stroke-dasharray="138.16" stroke-dashoffset="138.16"></circle>
                </svg>
            </div>
        </div>
        <div class="stat-trend up" id="velocity-trend">
            <i class="fas fa-users"></i>
            <span>Strong momentum</span>
        </div>
    </div>
</div>

<!-- Time Period Filter -->
<div class="filter-tabs fade-in" style="animation-delay: 0.3s;">
    <button class="filter-tab" data-period="today">
        <i class="fas fa-calendar-day"></i> Today
    </button>
    <button class="filter-tab" data-period="week">
        <i class="fas fa-calendar-week"></i> This Week
    </button>
    <button class="filter-tab active" data-period="month">
        <i class="fas fa-calendar"></i> This Month
    </button>
    <button class="filter-tab" data-period="year">
        <i class="fas fa-calendar-alt"></i> This Year
    </button>
</div>

<!-- Charts Section -->
<div class="charts-grid fade-in" style="animation-delay: 0.4s;">
    <div class="chart-card">
        <div class="chart-header">
            <h3 class="chart-title">Tasks Completion Trend</h3>
            <p class="chart-subtitle">Daily completion rate over time</p>
        </div>
        <div class="chart-placeholder">
            <i class="fas fa-chart-area"></i> Chart will be displayed here
        </div>
    </div>
    
    <div class="chart-card">
        <div class="chart-header">
            <h3 class="chart-title">Project Distribution</h3>
            <p class="chart-subtitle">Tasks by project status</p>
        </div>
        <div class="chart-placeholder">
            <i class="fas fa-chart-pie"></i> Chart will be displayed here
        </div>
    </div>
    
    <div class="chart-card">
        <div class="chart-header">
            <h3 class="chart-title">Priority Breakdown</h3>
            <p class="chart-subtitle">Tasks by priority level</p>
        </div>
        <div class="chart-placeholder">
            <i class="fas fa-chart-bar"></i> Chart will be displayed here
        </div>
    </div>
    
    <div class="chart-card">
        <div class="chart-header">
            <h3 class="chart-title">Team Performance</h3>
            <p class="chart-subtitle">Member activity and contributions</p>
        </div>
        <div class="chart-placeholder">
            <i class="fas fa-chart-column"></i> Chart will be displayed here
        </div>
    </div>
</div>

<!-- Recent Activity Section -->
<div class="glass-card slide-up">
    <div class="card-header">
        <h2 class="card-title">
            <i class="fas fa-clock-rotate-left"></i>
            Recent Activity
        </h2>
    </div>
    
    <div id="activity-list">
        <div class="empty-state">
            <i class="fas fa-chart-simple"></i>
            <h3>Loading analytics data...</h3>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Helper Functions
function getAuthHeaders() {
    const token = localStorage.getItem('accessToken');
    return token ? { 'Authorization': 'Bearer ' + token } : {};
}

function checkAuth(response) {
    if (response.status === 401 || response.status === 403) {
        localStorage.removeItem('accessToken');
        localStorage.removeItem('refreshToken');
        window.location.href = '/login/?next=' + encodeURIComponent(window.location.pathname);
        return false;
    }
    return true;
}

function showToast(message, type = 'info') {
    const existing = document.querySelector('.toast');
    if (existing) existing.remove();
    
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.style.cssText = `
        position: fixed;
        top: 24px;
        right: 24px;
        padding: 16px 24px;
        background: linear-gradient(135deg, #EC4899, #8B5CF6);
        color: #fff;
        border-radius: 16px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.4);
        z-index: 10000;
        font-weight: 600;
        animation: slideIn 0.4s ease;
    `;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.style.animation = 'slideIn 0.3s ease reverse';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

// Animate counter
function animateValue(id, end) {
    const el = document.getElementById(id);
    if (!el) return;
    
    let start = 0;
    const duration = 800;
    const startTime = performance.now();
    
    function step(now) {
        const t = Math.min(1, (now - startTime) / duration);
        const val = Math.round(start + (end - start) * (1 - Math.pow(1 - t, 3)));
        el.textContent = val;
        if (t < 1) requestAnimationFrame(step);
    }
    requestAnimationFrame(step);
}

// Animate percentage
function animatePercentage(id, end) {
    const el = document.getElementById(id);
    if (!el) return;
    
    let start = 0;
    const duration = 1000;
    const startTime = performance.now();
    
    function step(now) {
        const t = Math.min(1, (now - startTime) / duration);
        const val = Math.round(start + (end - start) * (1 - Math.pow(1 - t, 3)));
        el.textContent = val + '%';
        if (t < 1) requestAnimationFrame(step);
    }
    requestAnimationFrame(step);
}

// Load Analytics Data
async function loadAnalytics() {
    try {
        // Load Tasks
        const tasksResponse = await fetch('/api/tasks/', {
            credentials: 'include',
            headers: getAuthHeaders()
        });
        
        if (!checkAuth(tasksResponse)) return;
        
        const tasksData = await tasksResponse.json();
        const tasks = tasksData.results || tasksData;
        
        // Load Projects
        const projectsResponse = await fetch('/api/projects/', {
            credentials: 'include',
            headers: getAuthHeaders()
        });
        
        const projectsData = await projectsResponse.json();
        const projects = projectsData.results || projectsData;
        
        // Calculate Stats
        const totalTasks = tasks.length;
        const completedTasks = tasks.filter(t => t.status === 'done').length;
        const progressTasks = tasks.filter(t => t.status === 'in_progress').length;
        const totalProjects = projects.length;
        
        const productivity = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
        const efficiency = totalTasks > 0 ? Math.round((progressTasks / totalTasks) * 100) : 0;
        const quality = Math.min(95, Math.round(75 + Math.random() * 20)); // Mock data
        const velocity = Math.round(totalTasks / 7); // Tasks per day
        
        // Animate Stats
        animateValue('total-tasks', totalTasks);
        animateValue('completed-tasks', completedTasks);
        animateValue('progress-tasks', progressTasks);
        animateValue('total-projects', totalProjects);
        
        animatePercentage('productivity-score', productivity);
        animatePercentage('efficiency-score', efficiency);
        animatePercentage('quality-score', quality);
        animateValue('velocity-score', velocity);
        
        // Update progress ring
        const velocityCircle = document.getElementById('velocity-circle');
        if (velocityCircle) {
            const circumference = 138.16;
            const velocityPercent = Math.min(100, velocity * 10);
            const offset = circumference - (velocityPercent / 100) * circumference;
            setTimeout(() => {
                velocityCircle.style.strokeDashoffset = offset;
            }, 100);
        }
        
        // Display Recent Activity
        displayActivity(tasks.slice(0, 10));
        
    } catch (error) {
        console.error('Error loading analytics:', error);
        showToast('Error loading analytics data', 'error');
    }
}

// Display Activity
function displayActivity(tasks) {
    const activityList = document.getElementById('activity-list');
    
    if (tasks.length === 0) {
        activityList.innerHTML = '<div class="empty-state"><i class="fas fa-inbox"></i><h3>No recent activity</h3></div>';
        return;
    }
    
    activityList.innerHTML = tasks.map(task => {
        const status = task.status || 'todo';
        const statusLabel = status === 'done' ? 'Completed' : status === 'in_progress' ? 'In Progress' : 'Pending';
        const statusColor = status === 'done' ? '#10B981' : status === 'in_progress' ? '#8B5CF6' : '#F59E0B';
        
        return `
        <div style="
            padding: 16px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        ">
            <div>
                <div style="color: #fff; font-weight: 600; margin-bottom: 4px;">${task.title || 'Untitled'}</div>
                <div style="color: rgba(255,255,255,0.5); font-size: 13px;">
                    ${task.project_name || 'No project'} â€¢ ${new Date(task.created_at).toLocaleDateString()}
                </div>
            </div>
            <div style="
                padding: 6px 12px;
                background: ${statusColor}20;
                color: ${statusColor};
                border-radius: 20px;
                font-size: 12px;
                font-weight: 600;
            ">
                ${statusLabel}
            </div>
        </div>
    `}).join('');
}

// Event Listeners
document.getElementById('refresh-btn').addEventListener('click', () => {
    loadAnalytics();
    showToast('Analytics refreshed!', 'success');
});

document.getElementById('export-btn').addEventListener('click', () => {
    showToast('Export feature coming soon!', 'info');
});

// Filter tabs
document.querySelectorAll('.filter-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        const period = this.dataset.period;
        showToast(`Showing data for: ${period}`, 'info');
    });
});

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    loadAnalytics();
});
</script>
{% endblock %}
